<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Arcano | Or√°culo Pessoal</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --gold-light: #f9e29c; --glass: rgba(0, 0, 0, 0.3); --dark-bg: #050505; }
        body { margin: 0; font-family: 'Raleway', sans-serif; background: #000 url('portalarcano_background.jpg') no-repeat center center fixed; background-size: cover; color: white; line-height: 1.8; padding-bottom: 100px; }
        header { padding: 40px 20px 10px 20px; text-align: center; }
        h1 { font-family: 'Cinzel', serif; color: var(--gold); letter-spacing: 6px; margin: 0; text-shadow: 0 0 25px rgba(212, 175, 55, 0.5); font-size: 2.2em; }
        .subtitulo { letter-spacing: 4px; color: var(--gold-light); font-weight: 300; margin-top: 10px; text-transform: uppercase; font-size: 0.9em; }

        /* BARRA DE DNA ESPIRITUAL */
        .dna-espiritual { background: rgba(0, 0, 0, 0.8); border-top: 1px solid var(--gold); border-bottom: 1px solid var(--gold); padding: 15px; margin: 20px auto 40px auto; max-width: 900px; display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; font-size: 0.8em; text-transform: uppercase; letter-spacing: 1px; color: #ddd; backdrop-filter: blur(5px); }
        .dna-item { background: rgba(212, 175, 55, 0.1); padding: 5px 10px; border-radius: 4px; border: 1px solid rgba(212,175,55,0.3); }
        .dna-item b { color: var(--gold-light); }

        .container { max-width: 900px; margin: 0 auto; padding: 0 20px; }
        .secao { background: var(--glass); border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 20px; padding: 40px; margin-bottom: 50px; backdrop-filter: blur(4px); box-shadow: 0 15px 35px rgba(0,0,0,0.4); }
        h2 { font-family: 'Cinzel', serif; color: var(--gold); border-bottom: 1px solid rgba(212, 175, 55, 0.2); padding-bottom: 15px; margin-bottom: 25px; font-size: 1.5em; letter-spacing: 2px; }
        .destaque { color: var(--gold-light); font-weight: 600; }
        .texto-profundo { font-size: 1.1em; color: #f0f0f0; text-align: justify; margin-bottom: 20px; font-weight: 300; }
        
        .lock-container { background: rgba(20, 20, 20, 0.9); padding: 30px; border-radius: 15px; border: 1px dashed var(--gold); text-align: center; margin-top: 25px; }
        .btn-premium { background: linear-gradient(135deg, #d4af37 0%, #f9e29c 50%, #d4af37 100%); color: #000; padding: 16px 20px; border: none; border-radius: 5px; font-family: 'Cinzel', serif; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; margin-top: 10px; letter-spacing: 1px; font-size: 0.9em; transition: 0.3s; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3); }
        .btn-premium:hover { transform: scale(1.02); box-shadow: 0 0 25px var(--gold); }
        .nota-preco { font-size: 0.75em; color: #aaa; margin-top: 8px; font-style: italic; }

        input[type="text"] { width: 100%; padding: 12px; margin-top: 10px; background: rgba(255,255,255,0.05); border: 1px solid var(--gold); color: white; border-radius: 5px; box-sizing: border-box; }
        
        /* MAPA SVG */
        #chart-container { width: 300px; height: 300px; margin: 20px auto; position: relative; }
        svg { width: 100%; height: 100%; filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.3)); }

        .tag-elemento { background: rgba(212, 175, 55, 0.15); padding: 5px 15px; border-radius: 20px; font-size: 0.9em; border: 1px solid var(--gold); color: var(--gold-light); display: inline-block; margin-bottom: 15px; }
        
        .historico-item { background: rgba(0,0,0,0.6); padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid var(--gold); font-size: 0.9em; }
        .status-pendente { color: #f9e29c; font-style: italic; display: block; margin-top: 5px; font-size: 0.85em; }

        /* BARRA FIXA */
        .sticky-offer { position: fixed; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, #000, rgba(20, 20, 20, 0.95)); border-top: 2px solid var(--gold); padding: 15px; text-align: center; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .offer-text { color: var(--gold-light); font-size: 0.85em; margin-bottom: 5px; font-weight: bold; }
        .offer-btn { background: var(--gold); color: #000; padding: 8px 25px; border-radius: 30px; font-weight: bold; text-transform: uppercase; font-size: 0.8em; border: none; cursor: pointer; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); } 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); } }
    </style>
</head>
<body>

<header>
    <h1>PORTAL ARCANO</h1>
    <p class="subtitulo">AN√ÅLISE VIBRACIONAL</p>
</header>

<div class="dna-espiritual">
    <div class="dna-item">Nome: <b id="dna-nome">...</b></div>
    <div class="dna-item">Nasc: <b id="dna-nasc">...</b></div>
    <div class="dna-item">Hora: <b id="dna-hora">...</b></div>
    <div class="dna-item">Local: <b id="dna-local">...</b></div>
    <div class="dna-item">Sexo: <b id="dna-sexo">...</b></div>
    <div class="dna-item">Sol: <b id="dna-signo">...</b></div>
    <div class="dna-item">Asc: <b id="dna-asc">...</b></div>
</div>

<div class="container">
    
    <div class="secao">
        <h2>üî≠ Arquitetura da Alma</h2>
        <div class="texto-profundo">
            Sua vinda ao mundo em <span class="destaque" id="info-cidade">...</span> n√£o foi um acaso. O cosmos registrou sua assinatura exata. Calculamos que seu Sol est√° em <span class="destaque" id="info-signo-texto">...</span> e sua personalidade externa (Ascendente) se projeta atrav√©s de <span class="destaque" id="info-asc-texto">...</span>.
            <br><br>
            Detectamos uma <b>"Frequ√™ncia de Estagna√ß√£o"</b> no seu mapa. Voc√™ sente que, por mais que lute, uma for√ßa invis√≠vel trava seus resultados financeiros? Isso √© a tens√£o planet√°ria do seu nascimento agindo sem controle.
        </div>
        <div class="lock-container">
            <p>Sua <span class="destaque">D√≠vida C√°rmica</span> e as previs√µes para <span class="ano-dinamico">2026</span> est√£o protegidas.</p>
            <button class="btn-premium" onclick="irPagamento()">DESBLOQUEAR TUDO (R$ 29,90)</button>
            <p class="nota-preco">*Libera todo o portal: Mapa, Numerologia e Or√°culos.</p>
        </div>
    </div>

    <div class="secao" style="text-align: center;">
        <h2>üåå Seu C√©u de Nascimento</h2>
        <div id="chart-container"></div>
        <div class="texto-profundo">
            Este gr√°fico √© a representa√ß√£o matem√°tica do c√©u no seu hor√°rio exato (<span class="destaque" id="info-hora-mapa">...</span>). A concentra√ß√£o de planetas mostra onde est√° sua maior dor e seu maior tesouro nesta vida.
        </div>
        <button class="btn-premium" onclick="irPagamento()">BAIXAR Dossi√™ COMPLETO (PDF)</button>
    </div>

    <div class="secao">
        <h2>‚ú°Ô∏è O C√≥digo do Nome</h2>
        <div class="texto-profundo">
            Seu nome de nascimento, <span class="destaque" id="info-nome-nasc">...</span>, e a energia da sua linhagem materna (<span class="destaque" id="info-mae">...</span>), formam um algoritmo. Voc√™ pode estar vivendo sob uma "Assinatura de Escassez". Apenas o c√°lculo do Nome Sagrado pode corrigir isso.
        </div>
        <div class="lock-container">
            <button class="btn-premium" onclick="irPagamento()">LIBERAR NUMEROLOGIA</button>
        </div>
    </div>

    <div class="secao">
        <h2>üåø Ritual de Selamento √Åurico</h2>
        <p><span class="tag-elemento">Elemento Regente: <span id="userElemento">...</span></span></p>
        <div class="texto-profundo">
            Para sua vibra√ß√£o (Elemento <span id="info-elem-texto">...</span>), o banho de <b>Limpeza de Base</b> √© o recurso imediato.
            <br><b>Ingredientes:</b> Alecrim, Manjeric√£o e Arruda.
        </div>
        <div class="lock-container" style="border-color: #ff6b6b; background: rgba(255, 107, 107, 0.05);">
            <p>‚ö†Ô∏è <b>ATEN√á√ÉO:</b> Membros Premium recebem o <b>Banho Exclusivo do Dia</b>, calculado para os tr√¢nsitos de hoje.</p>
            <button class="btn-premium" onclick="irPagamento()">ATIVAR BANHOS EXCLUSIVOS</button>
        </div>
    </div>

    <div class="secao">
        <h2>‚õ©Ô∏è O Fluxo da Prosperidade</h2>
        <div class="texto-profundo">
            Existe um "ponto cego" no seu quarto que est√° drenando sua energia vital durante o sono. Sem corrigir isso atrav√©s do Feng Shui, o dinheiro entra e sai sem controle.
        </div>
        <div class="lock-container">
            <p>üîí O <b>Mapa do Bagu√°</b> da sua casa √© revelado no plano pago.</p>
            <button class="btn-premium" onclick="irPagamento()">HARMONIZAR MEU LAR</button>
        </div>
    </div>

    <div class="secao">
        <h2>üêâ O Animal Guardi√£o</h2>
        <div class="texto-profundo">
            Voc√™ √© regido pelo <span class="destaque" id="info-signo-chines">...</span>. No ano de <span class="ano-dinamico">2026</span>, a energia deste animal exige cautela extrema para evitar perdas.
        </div>
        <div class="lock-container">
            <button class="btn-premium" onclick="irPagamento()">VER PREVIS√ïES <span class="ano-dinamico">2026</span></button>
        </div>
    </div>

    <div class="secao">
        <h2>üîÆ Or√°culos e Consultas</h2>
        
        <div class="lock-container">
            <h3>üêö B√∫zios (1 hora)</h3>
            <input type="text" id="pergBuzios" placeholder="Sua pergunta...">
            <button class="btn-premium" onclick="solicitarConsulta('B√∫zios', 'pergBuzios')">ENVIAR (ACESSO TOTAL)</button>
        </div>

        <div class="lock-container" style="margin-top: 30px;">
            <h3>üÉè Tarot Cigano (30 min)</h3>
            <input type="text" id="pergCigano" placeholder="Sua pergunta...">
            <button class="btn-premium" onclick="solicitarConsulta('Tarot Cigano', 'pergCigano')">ENVIAR (ACESSO TOTAL)</button>
        </div>

        <div class="lock-container" style="margin-top: 30px;">
            <h3>üëÅÔ∏è Tarot Eg√≠pcio (2 horas)</h3>
            <input type="text" id="pergEgipcio" placeholder="O que o destino deve revelar?">
            <button class="btn-premium" onclick="solicitarConsulta('Tarot Eg√≠pcio', 'pergEgipcio')">ENVIAR (ACESSO TOTAL)</button>
        </div>

        <div id="secao-historico" style="margin-top: 50px; border-top: 1px solid rgba(212,175,55,0.3); padding-top: 30px;">
            <h3 style="font-family: 'Cinzel'; color: var(--gold); text-align: center;">Hist√≥rico de Consultas</h3>
            <div id="lista-historico"><p style="text-align: center; opacity: 0.5;">Carregando...</p></div>
        </div>
    </div>

    <div style="text-align: center; margin: 60px 0; opacity: 0.4;">
        <span onclick="excluirConta()" style="cursor:pointer; text-decoration: underline; font-size: 0.8em;">Encerrar Minha Jornada e Apagar Dados</span>
    </div>

</div>

<div class="sticky-offer" onclick="irPagamento()">
    <div class="offer-text">üîì OFERTA: Mapa + Tarot + Feng Shui + Numerologia</div>
    <button class="offer-btn">ATIVAR TUDO POR R$ 29,90</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDMeLgPB2wroI-papk-T9R_mbCcj3MC2TE",
        authDomain: "portal-mistico-6532b.firebaseapp.com",
        projectId: "portal-mistico-6532b",
        storageBucket: "portal-mistico-6532b.firebasestorage.app",
        messagingSenderId: "925159229004",
        appId: "1:925159229004:web:5d9dc758474789085016e9"
    };

    try {
        firebase.initializeApp(firebaseConfig);
    } catch(e) { console.error("Erro Firebase Init", e); }
    
    const auth = firebase.auth();
    const db = firebase.firestore();

    // === FUN√á√ïES MATEM√ÅTICAS SEGURAS ===
    const geoDB = {
        "SP": {lat:-23.55, lon:-46.63}, "SAO PAULO": {lat:-23.55, lon:-46.63},
        "RJ": {lat:-22.90, lon:-43.17}, "RIO": {lat:-22.90, lon:-43.17},
        "MG": {lat:-19.91, lon:-43.93}, "BH": {lat:-19.91, lon:-43.93},
        "DF": {lat:-15.79, lon:-47.88}, "BRASILIA": {lat:-15.79, lon:-47.88},
        "BA": {lat:-12.97, lon:-38.50}, "SALVADOR": {lat:-12.97, lon:-38.50},
        "DEFAULT": {lat:-15.79, lon:-47.88} 
    };

    function getCoords(str) {
        if(!str) return geoDB.DEFAULT;
        const s = str.toUpperCase();
        for(let k in geoDB) { if(s.includes(k)) return geoDB[k]; }
        return geoDB.DEFAULT;
    }

    function toJulian(date) { return (date.getTime() / 86400000) - (date.getTimezoneOffset() / 1440) + 2440587.5; }
    function normalize(deg) { deg = deg % 360; if (deg < 0) deg += 360; return deg; }
    
    function getSunLong(jd) {
        const n = jd - 2451545.0;
        const L = normalize(280.460 + 0.9856474 * n);
        const g = normalize(357.528 + 0.9856003 * n);
        return normalize(L + 1.915 * Math.sin(g * Math.PI/180));
    }

    function getAscendant(date, hora, lat, lon) {
        try {
            const [h, m] = hora.split(':').map(Number);
            const jd = toJulian(date);
            const t = (jd - 2451545.0) / 36525.0;
            const gmst = 280.46061837 + 360.98564736629 * (jd - 2451545.0) + 0.000387933 * t * t;
            const lst = normalize(gmst + (h+3)*15 + m*0.25 + lon); // +3h aproximado para UTC Brasil
            
            const eps = 23.439 * Math.PI / 180;
            const latRad = lat * Math.PI / 180;
            const lstRad = lst * Math.PI / 180;
            
            const y = Math.cos(lstRad);
            const x = - (Math.sin(lstRad) * Math.cos(eps) + Math.tan(latRad) * Math.sin(eps));
            return normalize((Math.atan2(y, x) * 180 / Math.PI));
        } catch(e) { return 0; }
    }

    function getSignName(deg) {
        const signs = ["√Åries", "Touro", "G√™meos", "C√¢ncer", "Le√£o", "Virgem", "Libra", "Escorpi√£o", "Sagit√°rio", "Capric√≥rnio", "Aqu√°rio", "Peixes"];
        return signs[Math.floor(deg / 30)] || "√Åries";
    }

    function drawChart(sun, asc) {
        const el = document.getElementById('chart-container');
        if(!el) return;
        const cx = 150, cy = 150, r = 120;
        let svg = `<svg viewBox="0 0 300 300">
            <circle cx="${cx}" cy="${cy}" r="${r}" fill="#050505" stroke="#d4af37" stroke-width="2"/>
            <g transform="rotate(${-asc + 180}, ${cx}, ${cy})">`; 
        
        for(let i=0; i<12; i++) {
            const rot = i * 30;
            svg += `<line x1="${cx}" y1="${cy}" x2="${cx + r}" y2="${cy}" transform="rotate(${rot}, ${cx}, ${cy})" stroke="rgba(212,175,55,0.3)" />`;
            const sym = ["‚ôà","‚ôâ","‚ôä","‚ôã","‚ôå","‚ôç","‚ôé","‚ôè","‚ôê","‚ôë","‚ôí","‚ôì"][i];
            svg += `<text x="${cx + r - 15}" y="${cy}" transform="rotate(${rot + 15}, ${cx}, ${cy})" fill="#fff" font-size="14" text-anchor="middle" alignment-baseline="middle" style="opacity:0.6">${sym}</text>`;
        }
        svg += `</g>`;
        
        // Plotar Sol
        const relSun = normalize(sun - asc + 180);
        const radSun = relSun * Math.PI / 180;
        const px = cx + (r * 0.7) * Math.cos(radSun);
        const py = cy + (r * 0.7) * Math.sin(radSun);
        svg += `<text x="${px}" y="${py}" fill="#ffd700" font-size="24" text-anchor="middle" alignment-baseline="middle">‚òâ</text>`;
        
        // Ascendente Marcador
        svg += `<path d="M ${cx-r} ${cy} L ${cx-r-10} ${cy-5} L ${cx-r-10} ${cy+5} Z" fill="#d4af37"/>`;
        svg += `</svg>`;
        el.innerHTML = svg;
    }

    // === INICIALIZA√á√ÉO ===
    const anoVenda = new Date().getMonth() >= 9 ? new Date().getFullYear() + 1 : new Date().getFullYear();
    document.querySelectorAll('.ano-dinamico').forEach(e => e.innerText = anoVenda);

    auth.onAuthStateChanged(user => {
        if (!user) { window.location.href = "index.html"; return; }

        db.collection("usuarios").doc(user.uid).onSnapshot(doc => {
            if (doc.exists) {
                const d = doc.data();
                
                const nome = d.nomeNascimento || d.nome || "Buscador";
                const mae = d.nomeMae || "Linhagem Materna";
                const nasc = d.dataNascimento || "2000-01-01";
                const hora = d.horaNascimento || "12:00";
                const local = d.localNascimento || "Brasil";
                const sexo = d.sexo || "Alma";

                // C√°lculos
                const [yyyy, mm, dd] = nasc.split('-').map(Number);
                const dateObj = new Date(yyyy, mm-1, dd);
                const coords = getCoords(local);
                
                const sunDeg = getSunLong(toJulian(dateObj));
                const ascDeg = getAscendant(dateObj, hora, coords.lat, coords.lon);
                
                const signoSolar = getSignName(sunDeg);
                const signoAsc = getSignName(ascDeg);

                // Preencher HTML
                const safeSet = (id, val) => { const el = document.getElementById(id); if(el) el.innerText = val; };
                
                safeSet('dna-nome', nome.split(' ')[0].toUpperCase());
                safeSet('dna-nasc', nasc);
                safeSet('dna-hora', hora);
                safeSet('dna-local', local);
                safeSet('dna-sexo', sexo);
                safeSet('dna-signo', signoSolar);
                safeSet('dna-asc', signoAsc);

                safeSet('info-cidade', local);
                safeSet('info-signo-texto', signoSolar);
                safeSet('info-asc-texto', signoAsc);
                safeSet('info-nome-nasc', nome);
                safeSet('info-mae', mae);
                safeSet('info-hora-mapa', hora);

                // Elemento
                let el = "√Ågua";
                if(["√Åries","Le√£o","Sagit√°rio"].includes(signoSolar)) el = "Fogo";
                else if(["Touro","Virgem","Capric√≥rnio"].includes(signoSolar)) el = "Terra";
                else if(["G√™meos","Libra","Aqu√°rio"].includes(signoSolar)) el = "Ar";
                safeSet('userElemento', el);
                safeSet('info-elem-texto', el);

                // Chin√™s
                const anoChines = ["Macaco","Galo","C√£o","Porco","Rato","Boi","Tigre","Coelho","Drag√£o","Serpente","Cavalo","Cabra"][yyyy % 12];
                safeSet('info-signo-chines', anoChines);

                // Desenhar Mapa
                drawChart(sunDeg, ascDeg);
            }
        });

        // Hist√≥rico
        db.collection("consultas").where("userId", "==", user.uid).orderBy("data", "desc")
            .onSnapshot(snap => {
                const lista = document.getElementById('lista-historico');
                if(!lista) return;
                if(snap.empty) { lista.innerHTML = "<p style='text-align:center; opacity:0.5'>Nenhuma consulta.</p>"; return; }
                lista.innerHTML = "";
                snap.forEach(r => {
                    const c = r.data();
                    lista.innerHTML += `<div class="historico-item"><b>${c.tipo}</b>: ${c.pergunta}<br><span class="status-pendente">Status: ${c.status || 'Pendente'}</span></div>`;
                });
            });
    });

    function solicitarConsulta(tipo, id) {
        const val = document.getElementById(id).value;
        if(!val) return alert("Digite sua pergunta.");
        db.collection("consultas").add({
            userId: auth.currentUser.uid,
            tipo: tipo,
            pergunta: val,
            data: new Date().toISOString(),
            status: 'Aguardando Mestre'
        }).then(() => {
            document.getElementById(id).value = "";
            window.open('https://www.mercadopago.com.br/', '_blank');
        });
    }

    function irPagamento() { window.open('https://www.mercadopago.com.br/', '_blank'); }
    
    function excluirConta() {
        if(confirm("Apagar tudo?")) {
            const u = auth.currentUser;
            db.collection("usuarios").doc(u.uid).delete().then(() => u.delete().then(() => location.href="index.html"));
        }
    }
</script>
</body>
</html>