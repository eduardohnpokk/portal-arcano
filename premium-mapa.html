<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Arcano | Mapa Astral</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --gold: #d4af37; --bg-dark: #050505; --card-bg: #0a0a0a; }
        body { margin: 0; font-family: 'Cormorant Garamond', serif; background: var(--bg-dark); color: #e0e0e0; font-size: 19px; }
        #loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { font-size: 4em; color: var(--gold); animation: spin 2s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .header-title { font-family: 'Cinzel'; color: var(--gold); text-align: center; margin-top: 40px; font-size: 2.5em; }
        .header-sub { text-align: center; color: #888; margin-bottom: 50px; }
        .astro-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 50px; }
        .astro-card { background: radial-gradient(circle, #111 0%, #000 100%); border: 1px solid var(--gold); padding: 20px; border-radius: 8px; text-align: center; }
        .astro-icon { font-size: 2.5em; color: var(--gold); margin-bottom: 10px; }
        .astro-value { font-family: 'Cinzel'; font-size: 1.5em; color: #fff; margin-top: 5px; }
        .report-block { background: var(--card-bg); padding: 30px; border-left: 4px solid var(--gold); border-bottom: 1px solid #222; margin-bottom: 30px; }
        .report-block h3 { margin: 0 0 15px 0; color: var(--gold); font-family: 'Cinzel'; font-size: 1.4em; }
        .btn-back { cursor: pointer; color: #888; text-transform: uppercase; font-size: 0.8em; margin-bottom: 20px; display: inline-block; }
    </style>
</head>
<body>
    <div id="loading-screen"><i class="fas fa-compass spinner"></i><p style="color:#666; font-family:'Cinzel';">Lendo os Astros...</p></div>
    <div class="container">
        <div onclick="window.location.href='dashboard-premium.html'" class="btn-back">← VOLTAR AO HUB</div>
        <h1 class="header-title">MAPA ASTRAL</h1>
        <div class="header-sub" id="user-info">...</div>
        <div class="astro-grid">
            <div class="astro-card"><div class="astro-icon"><i class="fas fa-sun"></i></div><div class="astro-label">Sol</div><div class="astro-value" id="val-sol">...</div></div>
            <div class="astro-card"><div class="astro-icon"><i class="fas fa-moon"></i></div><div class="astro-label">Lua</div><div class="astro-value" id="val-lua">...</div></div>
            <div class="astro-card"><div class="astro-icon"><i class="fas fa-arrow-up"></i></div><div class="astro-label">Ascendente</div><div class="astro-value" id="val-asc">...</div></div>
        </div>
        <div id="report-area"></div>
    </div>
<script>
    setTimeout(() => { document.getElementById('loading-screen').style.display = 'none'; }, 3000);
    const firebaseConfig = { apiKey: "AIzaSyDMeLgPB2wroI-papk-T9R_mbCcj3MC2TE", authDomain: "portal-mistico-6532b.firebaseapp.com", projectId: "portal-mistico-6532b", storageBucket: "portal-mistico-6532b.firebasestorage.app", messagingSenderId: "925159229004", appId: "1:925159229004:web:5d9dc758474789085016e9" };
    try { firebase.initializeApp(firebaseConfig); } catch(e) {}
    const auth = firebase.auth(); const db = firebase.firestore();
    const SIGNOS = ["Áries","Touro","Gêmeos","Câncer","Leão","Virgem","Libra","Escorpião","Sagitário","Capricórnio","Aquário","Peixes"];
    
    function getSigno(d,m){if((m==3&&d>=21)||(m==4&&d<=19))return "Áries";if((m==4&&d>=20)||(m==5&&d<=20))return "Touro";if((m==5&&d>=21)||(m==6&&d<=20))return "Gêmeos";if((m==6&&d>=21)||(m==7&&d<=22))return "Câncer";if((m==7&&d>=23)||(m==8&&d<=22))return "Leão";if((m==8&&d>=23)||(m==9&&d<=22))return "Virgem";if((m==9&&d>=23)||(m==10&&d<=22))return "Libra";if((m==10&&d>=23)||(m==11&&d<=21))return "Escorpião";if((m==11&&d>=22)||(m==12&&d<=21))return "Sagitário";if((m==12&&d>=22)||(m==1&&d<=19))return "Capricórnio";if((m==1&&d>=20)||(m==2&&d<=18))return "Aquário";return "Peixes";}
    function getAsc(s,h){if(!h)return "Desc.";const i=SIGNOS.indexOf(s);const hr=parseInt(h.split(':')[0]);const off=Math.floor((hr-6)/2);let a=(i+off)%12;if(a<0)a+=12;return SIGNOS[a];}
    function getLua(d){return "Nova";} // Simplificado

    function render(data, hora, nome){
        const [a,m,d] = data.split('-').map(Number);
        const sol = getSigno(d,m); const asc = getAsc(sol, hora);
        document.getElementById('user-info').innerText = `${nome} | ${data}`;
        document.getElementById('val-sol').innerText = sol;
        document.getElementById('val-asc').innerText = asc;
        document.getElementById('val-lua').innerText = "Nova"; // Placeholder seguro
        document.getElementById('report-area').innerHTML = `<div class="report-block"><h3>SOL EM ${sol.toUpperCase()}</h3><p>Sua essência vital.</p></div><div class="report-block"><h3>ASCENDENTE EM ${asc.toUpperCase()}</h3><p>Como o mundo te vê.</p></div>`;
        document.getElementById('loading-screen').style.display = 'none';
    }

    auth.onAuthStateChanged(user => {
        if(user){ db.collection("usuarios").doc(user.uid).get().then(doc=>{
            const d=doc.data();
            render(d.dataNascimento||"2000-01-01", d.horaNascimento||"12:00", d.nome||"Iniciado");
        }).catch(()=>render("2000-01-01","12:00","Offline")); } 
        else { window.location.href='index.html'; }
    });
</script>
</body>
</html>