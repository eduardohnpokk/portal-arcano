<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Arcano | Arquitetura da Alma</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --gold: #d4af37; --bg-dark: #050505; --card-bg: #0a0a0a; }
        
        body { margin: 0; font-family: 'Cormorant Garamond', serif; background: var(--bg-dark); color: #e0e0e0; font-size: 19px; }
        
        /* LOADING SCREEN (SEGURANÇA VISUAL) */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .spinner { font-size: 4em; color: var(--gold); animation: spin 2s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* CONTAINER */
        .container { max-width: 900px; margin: 0 auto; padding: 20px 20px 100px 20px; }
        
        /* BOTÕES DE NAVEGAÇÃO */
        .nav-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .btn-back { cursor: pointer; color: #666; text-transform: uppercase; font-size: 0.8em; letter-spacing: 2px; transition: 0.3s; border-bottom: 1px solid transparent; }
        .btn-back:hover { color: var(--gold); border-color: var(--gold); }
        .btn-print { background: var(--gold); color: #000; border: none; padding: 8px 15px; border-radius: 4px; font-family: 'Cinzel'; cursor: pointer; font-weight: bold; }

        /* HEADER */
        .page-header { text-align: center; margin-bottom: 40px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        .page-icon { font-size: 2.5em; color: var(--gold); margin-bottom: 15px; }
        .page-title { font-family: 'Cinzel'; color: var(--gold); font-size: 2.5em; margin: 0; text-shadow: 0 0 20px rgba(212,175,55,0.3); }
        .user-sub { color: #888; margin-top: 10px; font-size: 1.1em; }

        /* GRID DE CARTÕES (VISUAL) */
        .astro-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 50px; }
        .astro-card { 
            background: radial-gradient(circle, #111 0%, #000 100%); border: 1px solid var(--gold); 
            padding: 25px; border-radius: 8px; text-align: center; position: relative; overflow: hidden; 
            transition: 0.3s;
        }
        .astro-card:hover { transform: translateY(-5px); box-shadow: 0 0 20px rgba(212,175,55,0.15); }
        .astro-icon { font-size: 2.5em; color: var(--gold); margin-bottom: 10px; }
        .astro-label { color: #888; font-size: 0.8em; text-transform: uppercase; letter-spacing: 2px; }
        .astro-value { font-family: 'Cinzel'; font-size: 1.4em; color: #fff; margin-top: 8px; font-weight: bold; }

        /* RELATÓRIO NARRATIVO */
        .report-section { display: flex; flex-direction: column; gap: 30px; opacity: 0; animation: fadeIn 1s forwards; animation-delay: 0.5s; }
        @keyframes fadeIn { to { opacity: 1; } }

        .report-block { 
            background: rgba(20, 20, 20, 0.6); border: 1px solid #333; padding: 40px; 
            border-left: 3px solid var(--gold); border-radius: 4px; 
        }
        .report-block h3 { margin: 0 0 20px 0; color: var(--gold); font-family: 'Cinzel'; font-size: 1.6em; border-bottom: 1px solid #333; padding-bottom: 10px; }
        
        .narrative-text { font-size: 1.15em; line-height: 1.8; color: #ccc; text-align: justify; margin-bottom: 0; }
        .highlight { color: #fff; font-weight: bold; border-bottom: 1px solid var(--gold); }
        .gold-txt { color: var(--gold); font-family: 'Cinzel'; font-weight: bold; text-transform: uppercase; }

        @media(max-width: 600px) { .astro-grid { grid-template-columns: 1fr; } .narrative-text { text-align: left; } }
        @media print { .btn-back, .btn-print { display: none; } body { background: #fff; color: #000; } .astro-card, .report-block { border: 1px solid #000; color: #000; background: #fff; } }
    </style>
</head>
<body>

<div id="loading-screen">
    <i class="fas fa-compass spinner"></i>
    <p style="color:#666; font-family:'Cinzel'; margin-top:15px; letter-spacing:2px;">Alinhando os Astros...</p>
</div>

<div class="container">
    
    <div class="nav-bar">
        <div onclick="window.location.href='dashboard-premium.html'" class="btn-back">← Voltar ao Hub</div>
        <button onclick="window.print()" class="btn-print"><i class="fas fa-print"></i> Salvar Mapa</button>
    </div>

    <div class="page-header">
        <i class="fas fa-star page-icon"></i>
        <h1 class="page-title">ARQUITETURA DA ALMA</h1>
        <div class="user-sub" id="user-info">...</div>
    </div>

    <div class="astro-grid">
        <div class="astro-card">
            <div class="astro-icon"><i class="fas fa-sun"></i></div>
            <div class="astro-label">Essência (Sol)</div>
            <div class="astro-value" id="val-sol">...</div>
        </div>
        <div class="astro-card">
            <div class="astro-icon"><i class="fas fa-arrow-up"></i></div>
            <div class="astro-label">Máscara (Ascendente)</div>
            <div class="astro-value" id="val-asc">...</div>
        </div>
        <div class="astro-card">
            <div class="astro-icon"><i class="fas fa-moon"></i></div>
            <div class="astro-label">Emoção (Lua)</div>
            <div class="astro-value" id="val-lua">...</div>
        </div>
    </div>

    <div class="report-section" id="report-area">
        </div>
</div>

<script>
    // --- 1. SEGURANÇA (FAILSAFE 3s) ---
    setTimeout(() => { document.getElementById('loading-screen').style.display = 'none'; }, 3000);

    const firebaseConfig = { apiKey: "AIzaSyDMeLgPB2wroI-papk-T9R_mbCcj3MC2TE", authDomain: "portal-mistico-6532b.firebaseapp.com", projectId: "portal-mistico-6532b", storageBucket: "portal-mistico-6532b.firebasestorage.app", messagingSenderId: "925159229004", appId: "1:925159229004:web:5d9dc758474789085016e9" };
    try { firebase.initializeApp(firebaseConfig); } catch(e) {}
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- 2. CÁLCULOS E TEXTOS ---
    const SIGNOS = ["Áries", "Touro", "Gêmeos", "Câncer", "Leão", "Virgem", "Libra", "Escorpião", "Sagitário", "Capricórnio", "Aquário", "Peixes"];

    const TEXTOS_SOL = {
        "Áries": "Você é a centelha inicial, o guerreiro pioneiro. Sua energia é de ação direta e coragem. O universo te desenhou para iniciar ciclos.",
        "Touro": "Você busca a estabilidade e o prazer sensorial. Sua força é a persistência e a construção sólida. Você é o pilar que sustenta o mundo.",
        "Gêmeos": "Sua mente é veloz e curiosa. Você veio para conectar ideias e pessoas através da comunicação. Você é a ponte entre os mundos.",
        "Câncer": "Sua força reside na sensibilidade e na proteção. Você nutre e cuida daqueles que ama, criando raízes profundas onde quer que vá.",
        "Leão": "Você nasceu para brilhar e expressar sua criatividade. Sua nobreza de espírito inspira os outros. Você é o rei/rainha do seu próprio destino.",
        "Virgem": "Você busca a perfeição e a ordem. Seu serviço ao mundo é através da análise e do aprimoramento. Você traz a cura através do detalhe.",
        "Libra": "Sua missão é a harmonia e a justiça. Você busca o equilíbrio nas relações e a beleza em todas as formas. Você é o diplomata do zodíaco.",
        "Escorpião": "Você vive a intensidade e a transformação. Sua capacidade de renascer das cinzas é lendária. Você vê o que está oculto.",
        "Sagitário": "Você é o buscador da verdade e da liberdade. Sua flecha aponta para horizontes distantes e sabedoria superior. Você é o filósofo aventureiro.",
        "Capricórnio": "Você constrói com disciplina e ambição. Sua jornada é escalar a montanha da realização pessoal com paciência e estratégia.",
        "Aquário": "Você olha para o futuro e para o coletivo. Sua originalidade quebra padrões obsoletos. Você é o visionário humanitário.",
        "Peixes": "Você sente a conexão com o todo. Sua compaixão e sensibilidade artística são seus dons. Você é o místico natural."
    };

    function getSigno(d, m) {
        if((m==3&&d>=21)||(m==4&&d<=19)) return "Áries"; if((m==4&&d>=20)||(m==5&&d<=20)) return "Touro";
        if((m==5&&d>=21)||(m==6&&d<=20)) return "Gêmeos"; if((m==6&&d>=21)||(m==7&&d<=22)) return "Câncer";
        if((m==7&&d>=23)||(m==8&&d<=22)) return "Leão"; if((m==8&&d>=23)||(m==9&&d<=22)) return "Virgem";
        if((m==9&&d>=23)||(m==10&&d<=22)) return "Libra"; if((m==10&&d>=23)||(m==11&&d<=21)) return "Escorpião";
        if((m==11&&d>=22)||(m==12&&d<=21)) return "Sagitário"; if((m==12&&d>=22)||(m==1&&d<=19)) return "Capricórnio";
        if((m==1&&d>=20)||(m==2&&d<=18)) return "Aquário"; return "Peixes";
    }

    function getAsc(s, h) {
        if(!h) return "Desconhecido";
        const idx = SIGNOS.indexOf(s);
        const hr = parseInt(h.split(':')[0]);
        const off = Math.floor((hr - 6) / 2);
        let a = (idx + off) % 12;
        if(a < 0) a += 12;
        return SIGNOS[a];
    }

    function getLua(dataObj) {
        let year = dataObj.getFullYear(); let month = dataObj.getMonth() + 1; let day = dataObj.getDate();
        if (month < 3) { year--; month += 12; } ++month;
        let c = 365.25 * year; let e = 30.6 * month;
        let jd = c + e + day - 694039.09; jd /= 29.5305882;
        let b = parseInt(jd); jd -= b; b = Math.round(jd * 8);
        if (b >= 8) b = 0;
        const fases = ["Nova", "Crescente", "Quarto Crescente", "Gibosa Crescente", "Cheia", "Gibosa Minguante", "Quarto Minguante", "Minguante"];
        return fases[b];
    }

    // --- 3. RENDERIZAÇÃO ---
    function renderizar(nome, data, hora, cidade) {
        const [ano, mes, dia] = data.split('-').map(Number);
        const sol = getSigno(dia, mes);
        const asc = getAsc(sol, hora);
        const lua = getLua(new Date(ano, mes-1, dia));

        // Preenche Cabeçalho e Cartões
        document.getElementById('user-info').innerText = `${nome} • ${cidade} • ${data}`;
        document.getElementById('val-sol').innerText = sol;
        document.getElementById('val-asc').innerText = asc;
        document.getElementById('val-lua').innerText = lua;

        // Gera Relatório Narrativo
        const area = document.getElementById('report-area');
        area.innerHTML = `
            <div class="report-block">
                <h3>A Narrativa da Sua Alma</h3>
                <div class="narrative-text">
                    Sua vinda ao mundo em <span class="highlight">${cidade}</span> não foi um acaso. O cosmos registrou sua assinatura exata naquele momento.
                    <br><br>
                    Calculamos que seu Sol está em <span class="gold-txt">${sol}</span>. ${TEXTOS_SOL[sol]}
                    <br><br>
                    Enquanto o Sol define seu propósito interno, sua personalidade externa — a máscara que você usa para navegar no mundo — é regida pelo Ascendente em <span class="gold-txt">${asc}</span>. 
                    <br><br>
                    Suas emoções profundas fluem no ritmo de uma Lua <span class="gold-txt">${lua}</span>.
                </div>
            </div>

            <div class="report-block">
                <h3>Diagnóstico Energético</h3>
                <div class="narrative-text">
                    Ao cruzar seus dados de nascimento com o trânsito planetário atual, detectamos uma <span class="highlight">"Frequência de Estagnação"</span> em áreas chaves do seu mapa.
                    <br><br>
                    Você sente que, por mais que se esforce, existe uma "mão invisível" segurando seus resultados? Isso é a tensão entre o seu mapa natal e o momento atual.
                    <br><br>
                    <i style="color:#d4af37">Como Iniciado Premium, você tem acesso às ferramentas (Rituais e Feng Shui) para dissipar essa estagnação. Use o menu principal para acessá-las.</i>
                </div>
            </div>
        `;
        
        document.getElementById('loading-screen').style.display = 'none';
    }

    // --- 4. AUTH & LOAD ---
    auth.onAuthStateChanged(user => {
        if(user){
            db.collection("usuarios").doc(user.uid).get().then(doc => {
                const d = doc.exists ? doc.data() : {};
                
                // Correção de Dados (nascimento vs dataNascimento)
                const nome = d.nome || "Iniciado";
                const data = d.dataNascimento || d.nascimento || "2000-01-01";
                const hora = d.horaNascimento || d.hora || "12:00";
                const cidade = d.cidade || d.Cidade || "Local Desconhecido";

                // Checagem Premium
                const status = (d.status || "").toLowerCase();
                const plano = (d.plano || "").toLowerCase();

                if(status === "premium" || plano === "premium") {
                    renderizar(nome, data, hora, cidade);
                } else {
                    alert("Acesso Negado.");
                    window.location.href = 'index.html';
                }
            }).catch(e => {
                // Erro de rede (Offline Mode)
                renderizar("Visitante", "2000-01-01", "12:00", "Terra");
            });
        } else {
            window.location.href = 'index.html';
        }
    });
</script>
</body>
</html>