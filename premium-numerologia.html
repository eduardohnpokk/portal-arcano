<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Arcano | Numerologia Cabalística</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --gold: #d4af37; --bg-dark: #050505; --card-bg: #0a0a0a; }
        
        body { margin: 0; font-family: 'Cormorant Garamond', serif; background: var(--bg-dark); color: #e0e0e0; font-size: 19px; line-height: 1.6; }
        
        /* LOADING */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .spinner { font-size: 4em; color: var(--gold); animation: spin 2s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* CONTAINER */
        .container { max-width: 1000px; margin: 0 auto; padding: 20px 20px 100px 20px; }
        
        .nav-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .btn-back { cursor: pointer; color: #666; text-transform: uppercase; font-size: 0.8em; letter-spacing: 2px; border-bottom: 1px solid transparent; transition:0.3s; }
        .btn-back:hover { color: var(--gold); border-color: var(--gold); }
        .btn-print { background: var(--gold); color: #000; border: none; padding: 8px 15px; border-radius: 4px; font-family: 'Cinzel'; cursor: pointer; font-weight: bold; }

        .page-header { text-align: center; margin-bottom: 50px; }
        .page-title { font-family: 'Cinzel'; color: var(--gold); font-size: 2.8em; margin: 0; text-shadow: 0 0 20px rgba(212,175,55,0.3); }
        .user-details { color: #888; margin-top: 5px; font-size: 1.1em; letter-spacing: 1px; }

        /* GRID DE DESTAQUE (TOP CARDS) */
        .num-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-bottom: 60px; }
        
        .num-card { 
            background: radial-gradient(circle at top, #1a1a1a, #0a0a0a); 
            border: 1px solid #333; padding: 30px; border-radius: 8px; 
            text-align: center; transition: 0.3s; position: relative; overflow: hidden;
            border-top: 3px solid var(--gold);
        }
        .num-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(212,175,55,0.1); border-color: var(--gold); }
        
        .num-label { font-family: 'Cinzel'; font-size: 0.9em; color: #888; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; }
        .num-big { font-family: 'Cinzel'; font-size: 5em; color: var(--gold); line-height: 1; margin: 10px 0; text-shadow: 0 0 15px rgba(212,175,55,0.3); }
        .num-sub { font-size: 1em; color: #fff; font-weight: bold; }

        /* RELATÓRIO DENSO */
        .deep-report { display: flex; flex-direction: column; gap: 40px; }
        
        .report-block { 
            background: rgba(20, 20, 20, 0.8); border: 1px solid #333; padding: 40px; 
            border-left: 4px solid var(--gold); border-radius: 4px; 
        }
        .block-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .block-icon { font-size: 2em; color: var(--gold); }
        .block-title { font-family: 'Cinzel'; font-size: 1.8em; color: #fff; margin: 0; }
        
        .block-text { color: #ccc; text-align: justify; font-size: 1.1em; line-height: 1.9; }
        .keyword { color: var(--gold); font-weight: bold; }

        /* GRANDE SÍNTESE */
        .synthesis-box { 
            margin-top: 60px; background: radial-gradient(circle at center, #222 0%, #000 100%); 
            border: 2px solid var(--gold); padding: 50px; text-align: center; border-radius: 10px;
        }
        .synthesis-title { font-family: 'Cinzel'; font-size: 2.2em; color: var(--gold); margin-bottom: 30px; }
        .synthesis-text { font-size: 1.2em; color: #e0e0e0; text-align: justify; line-height: 2; }

        @media(max-width: 768px) { .num-grid { grid-template-columns: 1fr; } .block-header { flex-direction: column; text-align: center; } }
        @media print { .btn-back, .btn-print { display: none; } body { background: #fff; color: #000; } .num-card, .report-block, .synthesis-box { background: #fff; color: #000; border: 1px solid #000; } }
    </style>
</head>
<body>

<div id="loading-screen">
    <i class="fas fa-compass spinner"></i>
    <p style="color:#666; font-family:'Cinzel'; margin-top:15px; letter-spacing:2px;">Calculando Vibrações Numéricas...</p>
</div>

<div class="container">
    <div class="nav-bar">
        <div onclick="window.location.href='dashboard-premium.html'" class="btn-back">← Voltar ao Hub</div>
        <button onclick="window.print()" class="btn-print"><i class="fas fa-print"></i> Imprimir Dossiê</button>
    </div>

    <div class="page-header">
        <h1 class="page-title">DOSSIÊ NUMEROLÓGICO</h1>
        <div class="user-details" id="header-details">...</div>
    </div>

    <div class="num-grid">
        <div class="num-card">
            <div class="num-label">Caminho de Destino</div>
            <div class="num-big" id="val-destino">-</div>
            <div class="num-sub">A Missão</div>
        </div>
        <div class="num-card">
            <div class="num-label">Número de Expressão</div>
            <div class="num-big" id="val-expressao">-</div>
            <div class="num-sub">Os Talentos</div>
        </div>
        <div class="num-card">
            <div class="num-label">Motivação da Alma</div>
            <div class="num-big" id="val-alma">-</div>
            <div class="num-sub">O Desejo Oculto</div>
        </div>
    </div>

    <div class="deep-report" id="report-content">
        </div>

    <div class="synthesis-box">
        <h2 class="synthesis-title">SÍNTESE DA PERSONALIDADE</h2>
        <div class="synthesis-text" id="synthesis-text">
            </div>
    </div>

</div>

<script>
    // --- 1. FAILSAFE ---
    setTimeout(() => { document.getElementById('loading-screen').style.display = 'none'; }, 3000);

    const firebaseConfig = { apiKey: "AIzaSyDMeLgPB2wroI-papk-T9R_mbCcj3MC2TE", authDomain: "portal-mistico-6532b.firebaseapp.com", projectId: "portal-mistico-6532b", storageBucket: "portal-mistico-6532b.firebasestorage.app", messagingSenderId: "925159229004", appId: "1:925159229004:web:5d9dc758474789085016e9" };
    try { firebase.initializeApp(firebaseConfig); } catch(e) {}
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- 2. CÁLCULOS ---
    const TABELA = { 'a':1, 'j':1, 's':1, 'b':2, 'k':2, 't':2, 'c':3, 'l':3, 'u':3, 'd':4, 'm':4, 'v':4, 'e':5, 'n':5, 'w':5, 'f':6, 'o':6, 'x':6, 'g':7, 'p':7, 'y':7, 'h':8, 'q':8, 'z':8, 'i':9, 'r':9 };

    function reduzir(n) {
        if(n===11||n===22||n===33) return n;
        while(n > 9 && n!==11 && n!==22 && n!==33) {
            let s=0; String(n).split('').forEach(x=>s+=parseInt(x)); n=s;
        }
        return n;
    }

    function calcData(data) {
        if(!data) return 0;
        let s=0; data.replace(/-/g,'').split('').forEach(n=>s+=parseInt(n));
        return reduzir(s);
    }

    function calcNome(nome, tipo) {
        if(!nome) return 0;
        let s=0;
        const limpo = nome.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        for(let char of limpo) {
            if(TABELA[char]) {
                const vogal = "aeiou".includes(char);
                if(tipo==='tudo') s+=TABELA[char];
                if(tipo==='vogal' && vogal) s+=TABELA[char];
            }
        }
        return reduzir(s);
    }

    // --- 3. BIBLIOTECA DE TEXTOS DENSOS ---
    const TEXTOS = {
        1: "O Pioneiro. Você carrega a vibração da liderança, originalidade e independência. Sua alma escolheu um caminho onde você deve aprender a ficar de pé sozinho, confiar em seus instintos e abrir trilhas onde antes havia apenas mato. Seu desafio é o ego e a solidão do comando, mas sua glória é a conquista autêntica.",
        2: "O Diplomata. Sua vibração é de cooperação, sensibilidade e equilíbrio. Você é o 'fio condutor' que une pessoas e resolve conflitos. Sua força não está no grito, mas no sussurro e na persuasão. Seu desafio é não se anular pelos outros, mas sua dádiva é a verdadeira intimidade e parceria.",
        3: "O Expressivo. Você é a alegria, a criatividade e a comunicação em forma humana. Veio ao mundo para inspirar, falar, escrever ou criar arte. Sua energia é magnética e social. O perigo é a superficialidade ou a dispersão de talentos. Quando focado, você ilumina qualquer ambiente.",
        4: "O Construtor. Ordem, disciplina e trabalho duro definem sua vibração. Você não busca o sucesso rápido, mas o duradouro. Você é o alicerce da sociedade. Seu desafio é a rigidez e o medo da mudança, mas sua recompensa é construir um legado tangível e seguro para gerações.",
        5: "O Libertário. Mudança, aventura e liberdade são seu oxigênio. Você veio para experimentar os cinco sentidos ao máximo e quebrar regras obsoletas. A rotina te mata. Seu desafio é a instabilidade e o excesso, mas sua virtude é a adaptabilidade e o magnetismo pessoal.",
        6: "O Guardião. Amor, família e responsabilidade social. Você vibra na frequência do cuidado e da harmonia doméstica. As pessoas buscam seu ombro e seu conselho. Seu desafio é não carregar o mundo nas costas ou se intrometer demais, mas seu dom é criar lares e comunidades amorosas.",
        7: "O Sábio. Introspecção, análise e espiritualidade. Você é um buscador da verdade que precisa de solidão para processar a profundidade de seus pensamentos. O mundo material pode parecer barulhento demais. Seu desafio é o isolamento cínico, mas sua luz é a sabedoria profunda.",
        8: "O Executivo. Poder, ambição e autoridade material. Você entende o dinheiro e a gestão como ninguém. Veio para comandar grandes projetos. Seu desafio é o materialismo e a frieza, mas sua missão é gerar prosperidade e equilibrar o poder espiritual com o material.",
        9: "O Humanitário. Compaixão, generosidade e fim de ciclos. Você carrega a sabedoria de todos os números anteriores. Sua visão é global e altruísta. Seu desafio é o desapego pessoal e o drama emocional, mas sua missão é servir à humanidade e inspirar o amor universal.",
        11: "O Mestre Iluminador (11). Uma vibração elétrica de alta intuição. Você é um canal entre o plano espiritual e o material. Sua presença inspira e eleva. É um caminho de tensão nervosa, mas de grande potencial visionário.",
        22: "O Mestre Construtor (22). O poder de transformar grandes sonhos (11) em realidade tangível (4). Você tem a visão e a praticidade. É uma vibração de grande responsabilidade e capacidade de realização em escala global.",
        33: "O Mestre do Amor (33). A vibração do amor incondicional e do serviço abnegado. Raro e poderoso, indica uma vida dedicada a elevar a consciência coletiva através do cuidado e da compaixão."
    };

    // --- 4. RENDERIZAÇÃO ---
    function renderizar(nome, data) {
        document.getElementById('header-details').innerText = `${nome} • ${data}`;

        const nDestino = calcData(data);
        const nExpressao = calcNome(nome, 'tudo');
        const nAlma = calcNome(nome, 'vogal');

        // Cartões
        document.getElementById('val-destino').innerText = nDestino;
        document.getElementById('val-expressao').innerText = nExpressao;
        document.getElementById('val-alma').innerText = nAlma;

        // Relatório Denso
        const area = document.getElementById('report-content');
        area.innerHTML = `
            <div class="report-block">
                <div class="block-header">
                    <i class="fas fa-road block-icon"></i>
                    <h3 class="block-title">Caminho de Destino: ${nDestino}</h3>
                </div>
                <p class="block-text">
                    <span class="keyword">O Que Você Veio Aprender:</span> Este número é derivado da sua data de nascimento e é imutável. Ele representa o cenário da sua vida, as oportunidades e os desafios que o universo preparou para você.
                    <br><br>
                    ${TEXTOS[nDestino]}
                    <br><br>
                    Seu destino exige que você incorpore essas qualidades. Se você resistir a essa vibração, sentirá que está nadando contra a maré. Aceitá-la traz fluxo e propósito.
                </p>
            </div>

            <div class="report-block">
                <div class="block-header">
                    <i class="fas fa-fingerprint block-icon"></i>
                    <h3 class="block-title">Número de Expressão: ${nExpressao}</h3>
                </div>
                <p class="block-text">
                    <span class="keyword">Seus Talentos Naturais:</span> Derivado do seu nome completo, este número revela "quem você é" no palco do mundo. São suas habilidades inatas, a ferramenta que você usa para caminhar no seu Destino.
                    <br><br>
                    ${TEXTOS[nExpressao]}
                    <br><br>
                    Esta é a sua "Caixa de Ferramentas". Enquanto o Destino é a montanha a ser escalada, a Expressão é o equipamento que você trouxe na mochila. Use esses talentos ativamente.
                </p>
            </div>

            <div class="report-block">
                <div class="block-header">
                    <i class="fas fa-heart block-icon"></i>
                    <h3 class="block-title">Motivação da Alma: ${nAlma}</h3>
                </div>
                <p class="block-text">
                    <span class="keyword">O Que Seu Coração Pede:</span> Calculado apenas pelas vogais, este número é o mais íntimo. Ele revela seus desejos secretos, o que te faz feliz quando ninguém está olhando, sua motivação combustível.
                    <br><br>
                    ${TEXTOS[nAlma]}
                    <br><br>
                    Muitas vezes, ignoramos este número para agradar aos outros, o que causa um vazio interior. Honrar a vibração ${nAlma} é essencial para sentir-se verdadeiramente preenchido.
                </p>
            </div>
        `;

        // Grande Síntese
        document.getElementById('synthesis-text').innerHTML = `
            A análise conjunta dos seus números revela uma personalidade complexa. 
            <br><br>
            Você caminha numa estrada de <strong>${nDestino}</strong>, o que exige que você desenvolva as virtudes descritas acima. 
            Para isso, você está equipado com os talentos do <strong>${nExpressao}</strong>. 
            ${nDestino === nExpressao ? "Como seu Destino e Expressão são iguais, sua vida é muito focada e intensa numa única direção, facilitando o sucesso mas exigindo equilíbrio." : "A combinação entre o que você deve fazer (" + nDestino + ") e seus talentos (" + nExpressao + ") cria uma dinâmica única de aprendizado."}
            <br><br>
            No entanto, sua felicidade real depende de satisfazer o número <strong>${nAlma}</strong>. 
            Se sua vida externa (Destino/Expressão) estiver em conflito com este desejo interno, você sentirá insatisfação mesmo tendo sucesso material.
            <br><br>
            O segredo da sua harmonia é usar seus talentos (${nExpressao}) para cumprir sua missão (${nDestino}) de uma forma que alimente sua alma (${nAlma}).
        `;

        document.getElementById('loading-screen').style.display = 'none';
    }

    // --- 5. AUTH ---
    auth.onAuthStateChanged(user => {
        if(user){
            db.collection("usuarios").doc(user.uid).get().then(doc => {
                const d = doc.exists ? doc.data() : {};
                const nome = d.nome || "Iniciado";
                const data = d.dataNascimento || d.nascimento || "2000-01-01";
                const status = (d.status || "").toLowerCase();
                const plano = (d.plano || "").toLowerCase();

                if(status === "premium" || plano === "premium") {
                    renderizar(nome, data);
                } else {
                    alert("Acesso Restrito.");
                    window.location.href = 'index.html';
                }
            }).catch(e => { renderizar("Visitante", "2000-01-01"); });
        } else { window.location.href = 'index.html'; }
    });
</script>
</body>
</html>