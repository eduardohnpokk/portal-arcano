<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Arcano | Dossiê Numerológico</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    
    <script src="auth-guard.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --gold: #d4af37; --bg-dark: #050505; --card-bg: #0a0a0a; }
        
        body { margin: 0; font-family: 'Cormorant Garamond', serif; background: var(--bg-dark); color: #e0e0e0; font-size: 19px; padding-bottom: 100px; }
        
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        
        .header-title { font-family: 'Cinzel'; color: var(--gold); text-align: center; margin-top: 40px; font-size: 2.8em; letter-spacing: 2px; text-transform: uppercase; }
        .header-sub { text-align: center; color: #888; font-family: sans-serif; margin-bottom: 50px; text-transform: uppercase; font-size: 0.9em; letter-spacing: 1px; }

        .triangle-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 60px; text-align: center; }
        
        .t-card { 
            background: radial-gradient(circle, #111 0%, #000 100%); 
            border: 1px solid var(--gold); padding: 30px 10px; border-radius: 8px;
            box-shadow: 0 0 30px rgba(212,175,55,0.1); 
        }
        
        .t-num { font-family: 'Cinzel'; font-size: 3em; color: var(--gold); display: block; line-height: 1; margin-bottom: 10px; text-shadow: 0 0 10px var(--gold); }
        .t-label { color: #fff; font-weight: bold; text-transform: uppercase; font-size: 0.8em; letter-spacing: 2px; }

        .report-section { display: flex; flex-direction: column; gap: 40px; }
        
        .report-chapter { 
            background: var(--card-bg); padding: 40px; border-radius: 4px; 
            border-left: 5px solid var(--gold); border-bottom: 1px solid #222;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .num-header { display: flex; align-items: center; gap: 20px; margin-bottom: 25px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .num-big { font-family: 'Cinzel'; font-size: 3.5em; color: var(--gold); line-height: 1; }
        .num-meta h4 { margin: 0; color: #fff; font-size: 1.5em; font-family: 'Cinzel'; }
        .num-meta small { color: var(--gold); text-transform: uppercase; letter-spacing: 1px; }
        .num-content p { text-align: justify; line-height: 1.9; color: #ccc; margin-bottom: 15px; font-size: 1.1em; }
        
        .intro-box { background: #111; padding: 15px; border-left: 2px solid #555; margin-bottom: 20px; font-style: italic; color: #888; }

        .btn-float { position: fixed; bottom: 30px; right: 30px; background: linear-gradient(45deg, #d4af37, #f9e29c); color: #000; padding: 18px 35px; border-radius: 50px; font-family: 'Cinzel'; font-weight: bold; cursor: pointer; border: none; z-index: 100; font-size: 1.1em; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        .btn-back { cursor: pointer; color: #888; text-transform: uppercase; font-size: 0.8em; margin-bottom: 20px; display: inline-block; }

        @media print {
            .btn-float, .btn-back { display: none !important; }
            .container { max-width: 100%; padding: 0; }
            body { background: #fff; color: #000; }
            .t-card { border: 2px solid #000; background: #fff !important; box-shadow: none; color: #000; }
            .t-num, .t-label, .header-title { color: #000; text-shadow: none; }
            .report-chapter { background: #fff; border: none; border-bottom: 2px solid #000; color: #000; box-shadow: none; }
            .num-big, .num-meta h4, .num-meta small, .num-content p { color: #000 !important; }
        }
        @media(max-width: 600px) { .triangle-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div onclick="window.location.href='dashboard-premium.html'" class="btn-back">← VOLTAR AO HUB</div>
    
    <h1 class="header-title">DOSSIÊ NUMEROLÓGICO</h1>
    <div class="header-sub" id="user-info">Carregando dados...</div>

    <div class="triangle-grid">
        <div class="t-card">
            <span class="t-num" id="val-motivacao">-</span>
            <span class="t-label">Motivação (Alma)</span>
        </div>
        <div class="t-card">
            <span class="t-num" id="val-expressao">-</span>
            <span class="t-label">Expressão (Nome)</span>
        </div>
        <div class="t-card">
            <span class="t-num" id="val-destino">-</span>
            <span class="t-label">Destino (Data)</span>
        </div>
    </div>

    <div class="report-section" id="report-area"></div>
</div>

<button class="btn-float" onclick="window.print()"><i class="fas fa-file-pdf"></i> SALVAR DOSSIÊ</button>

<script>
    // --- 1. BANCO DE DADOS EMBUTIDO ---
    const TABELA_CABALA = {'A':1,'J':1,'S':3,'B':2,'K':2,'T':4,'C':3,'L':3,'U':6,'D':4,'M':4,'V':6,'E':5,'N':5,'W':5,'F':8,'O':7,'X':6,'G':3,'P':8,'Y':1,'H':5,'Q':1,'Z':7,'I':1,'R':2};
    const MAPA_ACENTOS = {'Á':'A','Ã':'A','Â':'A','É':'E','Ê':'E','Í':'I','Ó':'O','Ô':'O','Õ':'O','Ú':'U','Ç':'C'};
    
    const TEXTOS_NUMEROS = {
        "1": { titulo: "O Líder Pioneiro", arquetipo: "O Mago", desc: "Você possui uma fonte inesgotável de energia, iniciativa e originalidade. Não foi feito para seguir rebanhos.", motiva: "Sua alma grita por independência. Seu desejo secreto é ser o 'número um'.", impres: "O mundo te vê como uma figura de autoridade. Você projeta confiança e decisão.", destino: "Seu destino é aprender a liderar sem dominar. A inovação é sua chave." },
        "2": { titulo: "O Diplomata Sensitivo", arquetipo: "A Sacerdotisa", desc: "Você é a cola que mantém o mundo unido. Sua natureza é pacífica e diplomática.", motiva: "Sua alma anseia por harmonia e companhia. A solidão é dolorosa.", impres: "O mundo te vê como gentil, elegante e acessível. Uma aura de calma.", destino: "Seu caminho é sobre cooperação e paciência. Trabalhar nos bastidores." },
        "3": { titulo: "O Comunicador Criativo", arquetipo: "A Imperatriz", desc: "A vibração da autoexpressão. Sua mente é um caldeirão de ideias.", motiva: "Sua alma deseja o palco. Você precisa ser visto e ouvido.", impres: "O mundo te vê como carismático, divertido e cheio de vida.", destino: "Seu destino é inspirar os outros através da palavra ou arte." },
        "4": { titulo: "O Construtor Estável", arquetipo: "O Imperador", desc: "A vibração da ordem e da estrutura. Você é sólido e confiável.", motiva: "Sua alma busca segurança e estabilidade. O imprevisível te assusta.", impres: "O mundo te vê como a 'Rocha'. Alguém em quem se pode confiar cegamente.", destino: "Seu caminho é construir algo duradouro através do trabalho duro." },
        "5": { titulo: "O Viajante Livre", arquetipo: "O Hierofante (Reverso)", desc: "A energia da mudança e da liberdade. A rotina é seu veneno.", motiva: "Sua alma grita por liberdade. Você precisa de espaço para se mover.", impres: "O mundo te vê como magnético, sensual e imprevisível.", destino: "Seu destino é abraçar a mudança e ensinar flexibilidade." },
        "6": { titulo: "O Guardião Harmônico", arquetipo: "Os Enamorados", desc: "A vibração do amor e da responsabilidade. Você busca perfeição.", motiva: "Sua alma deseja cuidar e proteger. A harmonia familiar é vital.", impres: "O mundo te vê como um porto seguro. Alguém responsável e conselheiro.", destino: "Seu caminho é o do serviço amoroso e da cura." },
        "7": { titulo: "O Sábio Místico", arquetipo: "O Carro (Interior)", desc: "A vibração da espiritualidade e análise. Você busca a verdade oculta.", motiva: "Sua alma busca a Verdade e o silêncio para se conectar.", impres: "O mundo te vê como misterioso, inteligente e um pouco distante.", destino: "Seu caminho é o do autoconhecimento e especialização." },
        "8": { titulo: "O Visionário do Poder", arquetipo: "A Força", desc: "A potência da manifestação material. Você sabe lidar com dinheiro e poder.", motiva: "Sua alma deseja realizar grandes feitos e deixar um legado tangível.", impres: "O mundo te vê como um líder nato, alguém que impõe respeito.", destino: "Seu caminho é o domínio da matéria com justiça." },
        "9": { titulo: "O Humanitário Universal", arquetipo: "O Eremita", desc: "O ápice do ciclo. Você tem uma visão panorâmica e universal.", motiva: "Sua alma deseja servir ao mundo e fazer a diferença em larga escala.", impres: "O mundo te vê como carismático, sofisticado e generoso.", destino: "Seu caminho é o da finalização, desapego e inspiração." },
        "11": { titulo: "O Mestre Iluminado", arquetipo: "A Força Espiritual", desc: "Intuição elétrica. Você é um canal entre o mundo espiritual e material.", motiva: "Sua alma busca iluminação e inspirar os outros.", impres: "O mundo te vê como elétrico, diferente e inspirador.", destino: "Seu destino é ser um mensageiro de verdades superiores." },
        "22": { titulo: "O Mestre Construtor", arquetipo: "O Arquiteto", desc: "O poder de transformar sonhos espirituais em realidade concreta.", motiva: "Sua alma deseja deixar um legado monumental para a humanidade.", impres: "O mundo te vê como um gigante capaz do impossível.", destino: "Seu caminho é materializar o divino na Terra." }
    };

    // --- 2. LÓGICA DE CÁLCULO ---
    function limparTexto(str) { return str ? str.toUpperCase().trim() : ""; }
    function reduzir(n) {
        if (n === 11 || n === 22 || n === 33) return n;
        if (n < 10) return n;
        let sum = 0; String(n).split('').forEach(c => sum += parseInt(c));
        return reduzir(sum);
    }
    function calcularNome(nome) {
        const limpo = limparTexto(nome);
        let v=0, c=0; const VOGAIS = ['A','E','I','O','U'];
        for (let char of limpo) {
            if (MAPA_ACENTOS[char]) char = MAPA_ACENTOS[char];
            const val = TABELA_CABALA[char];
            if (!val) continue;
            (VOGAIS.includes(char) || char === 'Y') ? v += val : c += val;
        }
        return { motivacao: reduzir(v), impressao: reduzir(c), expressao: reduzir(v+c) };
    }
    function calcularDestino(data) {
        let total = 0; data.split('-').forEach(part => part.split('').forEach(n => total += parseInt(n)));
        return reduzir(total);
    }

    // --- 3. EXIBIÇÃO ---
    function executarAnalise(nome, data) {
        document.getElementById('user-info').innerText = `${nome} | ${data}`;
        const nNome = calcularNome(nome);
        const nDestino = calcularDestino(data);

        document.getElementById('val-motivacao').innerText = nNome.motivacao;
        document.getElementById('val-expressao').innerText = nNome.expressao;
        document.getElementById('val-destino').innerText = nDestino;

        const area = document.getElementById('report-area');
        area.innerHTML = "";
        
        const secoes = [
            { t: 'motivacao', v: nNome.motivacao, label: "MOTIVAÇÃO (ALMA)", sub: "O DESEJO SECRETO" },
            { t: 'impressao', v: nNome.impressao, label: "IMPRESSÃO (EGO)", sub: "A IMAGEM SOCIAL" },
            { t: 'expressao', v: nNome.expressao, label: "EXPRESSÃO (PERSONALIDADE)", sub: "QUEM VOCÊ É" },
            { t: 'destino', v: nDestino, label: "DESTINO (CAMINHO)", sub: "SUA MISSÃO DE VIDA" }
        ];

        secoes.forEach(s => {
            const info = TEXTOS_NUMEROS[String(s.v)] || TEXTOS_NUMEROS["1"];
            let textoEsp = info.desc;
            if(s.t === 'motivacao') textoEsp = info.motiva;
            if(s.t === 'impressao') textoEsp = info.impres;
            if(s.t === 'destino') textoEsp = info.destino;

            const div = document.createElement('div');
            div.className = 'report-chapter';
            div.innerHTML = `
                <div class="num-header">
                    <span class="num-big">${s.v}</span>
                    <div class="num-meta">
                        <h4>${s.label}</h4>
                        <small>${s.sub}</small>
                        <div style="color:var(--gold); font-size:0.9em;">Arquétipo: ${info.arquetipo}</div>
                    </div>
                </div>
                <div class="num-content"><p>${textoEsp}</p></div>
            `;
            area.appendChild(div);
        });
    }

    // --- 4. CONEXÃO SEGURA ---
    const firebaseConfig = { apiKey: "AIzaSyDMeLgPB2wroI-papk-T9R_mbCcj3MC2TE", authDomain: "portal-mistico-6532b.firebaseapp.com", projectId: "portal-mistico-6532b", storageBucket: "portal-mistico-6532b.firebasestorage.app", messagingSenderId: "925159229004", appId: "1:925159229004:web:5d9dc758474789085016e9" };
    try { firebase.initializeApp(firebaseConfig); } catch(e) {}
    const auth = firebase.auth();
    const db = firebase.firestore();

    auth.onAuthStateChanged(user => {
        if (!user) {
            // Visitante: Dados Demo (Para não travar)
            executarAnalise("Visitante", "2000-01-01");
        } else {
            db.collection("usuarios").doc(user.uid).get().then(doc => {
                if (doc.exists) {
                    const d = doc.data();
                    executarAnalise(d.nomeNascimento || d.nome || "Iniciado", d.dataNascimento || "2000-01-01");
                }
            });
        }
    });
</script>
</body>
</html>